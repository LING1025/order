<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.funtl.myshop.plus.provider.mapper.WorkFlowDocMapper">
  <resultMap id="BaseResultMap" type="com.funtl.myshop.plus.provider.domain.WorkFlowDoc">
    <!--@mbg.generated-->
    <!--@Table WorkFlowDoc-->
    <id column="WorkFlowDoc_Auto" jdbcType="BIGINT" property="workFlowDocAuto" />
    <result column="WorkFlow_Auto" jdbcType="BIGINT" property="workFlowAuto" />
    <result column="WorkFlowD_Auto" jdbcType="BIGINT" property="workFlowDAuto" />
    <result column="DocPostID" jdbcType="BIGINT" property="docPostID" />
    <result column="AppSeq" jdbcType="INTEGER" property="appSeq" />
    <result column="RoleID" jdbcType="INTEGER" property="roleId" />
    <result column="MaxLevel" jdbcType="INTEGER" property="maxLevel" />
    <result column="LevNow" jdbcType="INTEGER" property="levNow" />
    <result column="Status" jdbcType="INTEGER" property="status" />
    <result column="IsOver" jdbcType="INTEGER" property="isOver" />
    <result column="Rights" jdbcType="INTEGER" property="rights" />
    <result column="DefaultStatus" jdbcType="INTEGER" property="defaultStatus" />
    <result column="InActiveList" jdbcType="INTEGER" property="inActiveList" />
    <result column="LimitDept" jdbcType="INTEGER" property="limitDept" />
    <result column="IsAgent" jdbcType="INTEGER" property="isAgent" />
    <result column="Memo" jdbcType="VARCHAR" property="memo" />
    <result column="CUser" jdbcType="INTEGER" property="cuser" />
    <result column="MUser" jdbcType="INTEGER" property="muser" />
    <result column="CDT" jdbcType="TIMESTAMP" property="cdt" />
    <result column="MDT" jdbcType="TIMESTAMP" property="mdt" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated-->
    WorkFlowDoc_Auto, WorkFlow_Auto, WorkFlowD_Auto, DocPostID, AppSeq, RoleID, MaxLevel,
    LevNow, [Status], IsOver, Rights, DefaultStatus, InActiveList, LimitDept, IsAgent,
    Memo, CUser, MUser, CDT, MDT
  </sql>
  <resultMap id="querySignOffList" extends="BaseResultMap" type="com.funtl.myshop.plus.provider.domain.SignOffList">
    <result column="ordersFDetailAuto" jdbcType="INTEGER" property="ordersFDetailAuto" />
    <result column="ordersAuto" jdbcType="INTEGER" property="ordersAuto" />
    <result column="ordersStatus" jdbcType="INTEGER" property="ordersStatus" />
    <result column="isAgent" jdbcType="INTEGER" property="isAgent" />
    <result column="roleName" jdbcType="VARCHAR" property="roleName" />
    <result column="memo" jdbcType="VARCHAR" property="memo" />
    <result column="creditPerson" jdbcType="VARCHAR" property="creditPerson" />
  </resultMap>
  <select id="selectSignOffList" resultMap="querySignOffList">
    select 0 ordersFDetailAuto,a.DocPostID ordersAuto,'' memo,0 ordersStatus,0 isAgent,'' creditPerson,c.Memo roleName,a.WorkFlowDoc_Auto
    from  WorkFlowDoc(nolock) a
    left join Orders b On b.Orders_Auto=a.DocPostID
    left join ItemCode c on c.ItemType = 1062 and c.Num = a.RoleID
    where a.DocPostID=#{docPostID} And a.[status]=0 And a.Memo='999'And a.RoleID = #{roleId}
  </select>
  <select id="selectWorkFlowDoc" resultMap="BaseResultMap">
    declare
    @Orders_AUTO Int=#{docPostID},
    @RoleId Int=#{roleId},
    @Type Int=#{type}
    Begin
    if @Type = 0
    begin
    select *
    from dbo.WorkFlowDoc a
    where a.docpostid = @Orders_AUTO and a.[status] &gt;= 0 and a.[status] != 5 and @Orders_AUTO != 0
    end
    else
    begin
    select *
    from dbo.WorkFlowDoc a
    where a.docpostid = @Orders_AUTO and a.[status] = 20 and a.roleid = @RoleId
    end
    End
  </select>
</mapper>
