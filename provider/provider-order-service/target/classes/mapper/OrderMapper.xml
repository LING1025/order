<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.funtl.myshop.plus.provider.mapper.OrderMapper">
    <resultMap id="BaseResultMap" type="com.funtl.myshop.plus.provider.domain.Order">
        <!--@mbg.generated-->
        <!--@Table [Order]-->
        <id column="Order_Auto" jdbcType="BIGINT" property="orderAuto"/>
        <result column="Orders_Auto" jdbcType="BIGINT" property="ordersAuto"/>
        <result column="TradeItem_Auto" jdbcType="BIGINT" property="tradeItemAuto"/>
        <result column="CarBase_Auto" jdbcType="BIGINT" property="carBaseAuto"/>
        <result column="Sales_Auto" jdbcType="BIGINT" property="salesAuto"/>
        <result column="OrderNo" jdbcType="VARCHAR" property="orderNo"/>
        <result column="LinceNo" jdbcType="VARCHAR" property="linceNo"/>
        <result column="StartDT" jdbcType="TIMESTAMP" property="startDT"/>
        <result column="EndDT" jdbcType="TIMESTAMP" property="endDT"/>
        <result column="ResDT" jdbcType="TIMESTAMP" property="resDT"/>
        <result column="Status" jdbcType="INTEGER" property="status"/>
        <result column="Memo" jdbcType="VARCHAR" property="memo"/>
        <result column="Brand_Auto" jdbcType="INTEGER" property="brandAuto"/>
        <result column="Clasen_Auto" jdbcType="INTEGER" property="clasenAuto"/>
        <result column="ListPrice" jdbcType="DECIMAL" property="listPrice"/>
        <result column="DisPrice" jdbcType="DECIMAL" property="disPrice"/>
        <result column="GetPrice" jdbcType="DECIMAL" property="getPrice"/>
        <result column="Accessary" jdbcType="DECIMAL" property="accessary"/>
        <result column="PushMoney" jdbcType="DECIMAL" property="pushMoney"/>
        <result column="CarCost" jdbcType="DECIMAL" property="carCost"/>
        <result column="RentAmt" jdbcType="DECIMAL" property="rentAmt"/>
        <result column="OverAmt" jdbcType="DECIMAL" property="overAmt"/>
        <result column="DptAmt" jdbcType="DECIMAL" property="dptAmt"/>
        <result column="MM" jdbcType="INTEGER" property="mm"/>
        <result column="MAmt" jdbcType="DECIMAL" property="mAmt"/>
        <result column="MakNo" jdbcType="VARCHAR" property="makNo"/>
        <result column="CarTax" jdbcType="DECIMAL" property="carCost"/>
        <result column="InsurePercnt" jdbcType="INTEGER" property="insurePercnt"/>
        <result column="IsBusiness" jdbcType="INTEGER" property="isBusiness"/>
        <result column="RentType" jdbcType="INTEGER" property="rentType"/>
        <result column="UseType" jdbcType="INTEGER" property="useType"/>
        <result column="CarSource" jdbcType="INTEGER" property="carSource"/>
        <result column="DriverAmt" jdbcType="DECIMAL" property="driverAmt"/>
        <result column="OilAmt" jdbcType="DECIMAL" property="oilAmt"/>
        <result column="DriveService" jdbcType="DECIMAL" property="driveService"/>
        <result column="RateKM" jdbcType="DECIMAL" property="rateKM"/>
        <result column="LinceKM" jdbcType="DECIMAL" property="linceKM"/>
        <result column="CarMtnAmt" jdbcType="DECIMAL" property="carMtnAmt"/>
        <result column="whiel" jdbcType="INTEGER" property="whiel"/>
        <result column="OverKM" jdbcType="DECIMAL" property="overKM"/>
        <result column="OverKMPayType" jdbcType="INTEGER" property="overKMPayType"/>
        <result column="PayMode" jdbcType="INTEGER" property="payMode"/>
        <result column="PayDay" jdbcType="INTEGER" property="payDay"/>
        <result column="RateRate" jdbcType="DECIMAL" property="rateRate"/>
        <result column="RateInsure" jdbcType="DECIMAL" property="rateInsure"/>
        <result column="RateInsureD" jdbcType="DECIMAL" property="rateInsured"/>
        <result column="RateMCost" jdbcType="DECIMAL" property="rateMCost"/>
        <result column="RateYCost" jdbcType="DECIMAL" property="rateYCost"/>
        <result column="RateTCost" jdbcType="DECIMAL" property="rateTCost"/>
        <result column="RateM" jdbcType="DECIMAL" property="rateM"/>
        <result column="RateY" jdbcType="DECIMAL" property="rateY"/>
        <result column="RateT" jdbcType="DECIMAL" property="rateT"/>
        <result column="RateCost" jdbcType="DECIMAL" property="rateCost"/>
        <result column="RateDPN" jdbcType="DECIMAL" property="rateDPN"/>
        <result column="RateTax" jdbcType="DECIMAL" property="rateTax"/>
        <result column="RateAmt" jdbcType="DECIMAL" property="rentAmt"/>
        <result column="FinalRate" jdbcType="DECIMAL" property="finalRate"/>
        <result column="FinalInsure" jdbcType="DECIMAL" property="finalInsure"/>
        <result column="FinalInsureD" jdbcType="DECIMAL" property="finalInsured"/>
        <result column="FinalMCost" jdbcType="DECIMAL" property="finalMCost"/>
        <result column="FinalYCost" jdbcType="DECIMAL" property="finalYCost"/>
        <result column="FinalTCost" jdbcType="DECIMAL" property="finalTCost"/>
        <result column="FinalM" jdbcType="DECIMAL" property="finalM"/>
        <result column="FinalY" jdbcType="DECIMAL" property="finalY"/>
        <result column="FinalT" jdbcType="DECIMAL" property="finalT"/>
        <result column="FinalCost" jdbcType="DECIMAL" property="finalCost"/>
        <result column="FinalDPN" jdbcType="DECIMAL" property="finalDPN"/>
        <result column="FinalTax" jdbcType="DECIMAL" property="finalTax"/>
        <result column="FinalAmt" jdbcType="DECIMAL" property="finalAmt"/>
        <result column="RentTotal" jdbcType="DECIMAL" property="rentTotal"/>
        <result column="GrossMarginT" jdbcType="DECIMAL" property="grossMarginT"/>
        <result column="GrossMargin" jdbcType="DECIMAL" property="grossMargin"/>
        <result column="RentRate" jdbcType="DECIMAL" property="rateRate"/>
        <result column="CUser" jdbcType="INTEGER" property="cUser"/>
        <result column="CDT" jdbcType="TIMESTAMP" property="cDT"/>
        <result column="MUser" jdbcType="INTEGER" property="mUser"/>
        <result column="MDT" jdbcType="TIMESTAMP" property="mDT"/>
        <result column="CustSource" jdbcType="INTEGER" property="custSource"/>
        <result column="Arrange" jdbcType="DECIMAL" property="arrange"/>
        <result column="ArrangeDay" jdbcType="BIGINT" property="arrangeDay"/>
        <result column="Inc_Auto" jdbcType="BIGINT" property="incAuto"/>
        <result column="RealRate" jdbcType="DECIMAL" property="realRate"/>
        <result column="RealGMT" jdbcType="DECIMAL" property="realGMT"/>
        <result column="RealGM" jdbcType="DECIMAL" property="realGM"/>
        <result column="RealRentRate" jdbcType="DECIMAL" property="realRentRate"/>
        <result column="MakNoCost" jdbcType="DECIMAL" property="makNoCost"/>
        <result column="MakNoOverAmt" jdbcType="DECIMAL" property="makNoOverAmt"/>
        <result column="A1" jdbcType="VARCHAR" property="a1"/>
        <result column="B1" jdbcType="VARCHAR" property="b1"/>
        <result column="B2" jdbcType="VARCHAR" property="b2"/>
        <result column="B3" jdbcType="VARCHAR" property="b3"/>
        <result column="B4" jdbcType="VARCHAR" property="b4"/>
        <result column="IsCHK" jdbcType="INTEGER" property="isChk"/>
        <result column="OrderType" jdbcType="INTEGER" property="orderType"/>
        <result column="InvDT" jdbcType="INTEGER" property="invDT"/>
        <result column="InvStop" jdbcType="INTEGER" property="invStop"/>
        <result column="InvStopMemo" jdbcType="VARCHAR" property="invStopMemo"/>
        <result column="StampTax" jdbcType="DECIMAL" property="stampTax"/>
        <result column="SellCarTax" jdbcType="DECIMAL" property="sellCarTax"/>
        <result column="IRR" jdbcType="DECIMAL" property="irr"/>
        <result column="NPV" jdbcType="DECIMAL" property="npv"/>
        <result column="TrnsFee" jdbcType="DECIMAL" property="trnsFee"/>
        <result column="NeedFile" jdbcType="BIGINT" property="needFile"/>
        <result column="MakeFile" jdbcType="BIGINT" property="makeFile"/>
        <result column="NeedFileNum" jdbcType="BIGINT" property="needFileNum"/>
        <result column="MakeFileNum" jdbcType="BIGINT" property="makeFileNum"/>
        <result column="RentAmtReal" jdbcType="DECIMAL" property="rentAmtReal"/>
        <result column="Sub_Auto" jdbcType="BIGINT" property="subAuto"/>
        <result column="RealCarCost" jdbcType="DECIMAL" property="realCarCost"/>
        <result column="CollMemo" jdbcType="VARCHAR" property="collMemo"/>
        <result column="DPNMAmt" jdbcType="DECIMAL" property="dpnMAmt"/>
        <result column="IncVirCardNo" jdbcType="VARCHAR" property="incVirCardNo"/>
        <result column="RealDptAmt" jdbcType="DECIMAL" property="realDptAmt"/>
        <result column="RealDptDT" jdbcType="TIMESTAMP" property="realDptDT"/>
        <result column="RealDptISPrinter" jdbcType="INTEGER" property="realDptISprinter"/>
        <result column="DptPrinterDT" jdbcType="TIMESTAMP" property="dptPrinterDT"/>
        <result column="DptRemark" jdbcType="VARCHAR" property="dptPrinterDT"/>
        <result column="OrderMemo" jdbcType="VARCHAR" property="orderMemo"/>
        <result column="C1" jdbcType="VARCHAR" property="c1"/>
        <result column="C2" jdbcType="VARCHAR" property="c2"/>
        <result column="C3" jdbcType="VARCHAR" property="c3"/>
        <result column="D1" jdbcType="VARCHAR" property="d1"/>
        <result column="D2" jdbcType="VARCHAR" property="d2"/>
        <result column="D3" jdbcType="VARCHAR" property="d3"/>
        <result column="D4" jdbcType="VARCHAR" property="d4"/>
        <result column="D5" jdbcType="VARCHAR" property="d5"/>
        <result column="TaxMode" jdbcType="INTEGER" property="taxMode"/>
        <result column="TaxRate" jdbcType="DECIMAL" property="taxRate"/>
        <result column="chkListPrice" jdbcType="INTEGER" property="chkListPrice"/>
        <result column="BoundDT" jdbcType="TIMESTAMP" property="boundDT"/>
        <result column="BoundStatus" jdbcType="INTEGER" property="bonusStatus"/>
        <result column="JCDT" jdbcType="TIMESTAMP" property="jcDT"/>
        <result column="IsMerit" jdbcType="INTEGER" property="isMerit"/>
        <result column="RunDT" jdbcType="TIMESTAMP" property="runDT"/>
        <result column="YJCDT" jdbcType="TIMESTAMP" property="yjcDT"/>
        <result column="YJSales" jdbcType="INTEGER" property="yjSales"/>
        <result column="YJOrg" jdbcType="INTEGER" property="yjOrg"/>
        <result column="Scooter" jdbcType="VARCHAR" property="scooter"/>
        <result column="DisType" jdbcType="INTEGER" property="disPrice"/>
        <result column="InvStopEndDT" jdbcType="TIMESTAMP" property="invStopMemo"/>
        <result column="IsBonus" jdbcType="INTEGER" property="isBonus"/>
        <result column="IsRemoveOverdue" jdbcType="INTEGER" property="isRemoveOverdue"/>
        <result column="BonusStatus" jdbcType="INTEGER" property="bonusStatus"/>
        <result column="BonusYY" jdbcType="INTEGER" property="bonusYY"/>
        <result column="BonusMM" jdbcType="INTEGER" property="bonusMM"/>
        <result column="BonusAmt" jdbcType="DECIMAL" property="bonusAmt"/>
        <result column="IsLawEnd" jdbcType="INTEGER" property="isLawEnd"/>
        <result column="ReletMakno" jdbcType="VARCHAR" property="reletMakNo"/>
        <result column="IsRelet" jdbcType="INTEGER" property="isRelet"/>
        <result column="DptAmtTrnDT" jdbcType="TIMESTAMP" property="dptAmtTrnDT"/>
        <result column="BonusRate" jdbcType="DECIMAL" property="bonusRate"/>
        <result column="BonusCarCost" jdbcType="DECIMAL" property="bonusCarCost"/>
        <result column="IsBlack" jdbcType="INTEGER" property="isBlack"/>
        <result column="BlackDT" jdbcType="TIMESTAMP" property="blackDT"/>
        <result column="OutFee" jdbcType="DECIMAL" property="outFee"/>
        <result column="FinanceFee" jdbcType="DECIMAL" property="financeFee"/>
        <result column="UrgentFee" jdbcType="DECIMAL" property="urgentFee"/>
        <result column="QJRemark" jdbcType="VARCHAR" property="qJRemark"/>
    </resultMap>
    <sql id="Base_Column_List">
        <!--@mbg.generated-->
        Order_Auto, Orders_Auto, TradeItem_Auto, CarBase_Auto, Sales_Auto, OrderNo, LinceNo,
        StartDT, EndDT, ResDT, [Status], Memo, Brand_Auto, Clasen_Auto, ListPrice, DisPrice,
        GetPrice, Accessary, PushMoney, CarCost, RentAmt, OverAmt, DptAmt, MM, MAmt, MakNo,
        CarTax, InsurePercnt, IsBusiness, RentType, UseType, CarSource, DriverAmt, OilAmt,
        DriveService, RateKM, LinceKM, CarMtnAmt, whiel, OverKM, OverKMPayType, PayMode,
        PayDay, RateRate, RateInsure, RateInsureD, RateMCost, RateYCost, RateTCost, RateM,
        RateY, RateT, RateCost, RateDPN, RateTax, RateAmt, FinalRate, FinalInsure, FinalInsureD,
        FinalMCost, FinalYCost, FinalTCost, FinalM, FinalY, FinalT, FinalCost, FinalDPN,
        FinalTax, FinalAmt, RentTotal, GrossMarginT, GrossMargin, RentRate, CUser, CDT, MUser,
        MDT, CustSource, Arrange, ArrangeDay, Inc_Auto, RealRate, RealGMT, RealGM, RealRentRate,
        MakNoCost, MakNoOverAmt, A1, B1, B2, B3, B4, IsCHK, OrderType, InvDT, InvStop, InvStopMemo,
        StampTax, SellCarTax, IRR, NPV, TrnsFee, NeedFile, MakeFile, NeedFileNum, MakeFileNum,
        RentAmtReal, Sub_Auto, RealCarCost, CollMemo, DPNMAmt, IncVirCardNo, RealDptAmt,
        RealDptDT, RealDptISPrinter, DptPrinterDT, DptRemark, OrderMemo, C1, C2, C3, D1,
        D2, D3, D4, D5, TaxMode, TaxRate, chkListPrice, BoundDT, BoundStatus, JCDT, IsMerit,
        RunDT, YJCDT, YJSales, YJOrg, Scooter, DisType, InvStopEndDT, IsBonus, IsRemoveOverdue,
        BonusStatus, BonusYY, BonusMM, BonusAmt, IsLawEnd, ReletMakno, IsRelet, DptAmtTrnDT,
        BonusRate, BonusCarCost, IsBlack, BlackDT, OutFee, FinanceFee, UrgentFee, QJRemark
    </sql>
    <resultMap id="queryClasenList" extends="BaseResultMap" type="com.funtl.myshop.plus.provider.domain.ClasenList">
        <result column="salesName" jdbcType="VARCHAR" property="salesName"/>
        <result column="supplierName" jdbcType="VARCHAR" property="supplierName"/>
        <result column="MakDT" jdbcType="TIMESTAMP" property="makeDT"/>
        <result column="realRate" jdbcType="VARCHAR" property="realRate"/>
        <result column="StartDT" jdbcType="TIMESTAMP" property="startDT"/>
    </resultMap>
    <select id="selectClasenList" resultMap="queryClasenList">
        select
        distinct a.Order_Auto,a.StartDT,
        convert(decimal(18,0),a.ListPrice) ListPrice,
        convert(decimal(18,0),a.GetPrice) GetPrice,
        convert(decimal(18,0),a.DisPrice) DisPrice,
        isnull(d.FName,17) as salesName,f.SName as supplierName,c.MakDT,
        convert(varchar(10),convert(decimal(18,2),((1-cast(a.GetPrice as int) *1.0/cast(a.ListPrice as int)) *
        100)))+'%' as realRate
        from [Order] a
        inner join OrderRent b on a.Order_Auto=b.Order_Auto
        inner join CarBase c on a.CarBase_Auto=c.CarBase_Auto
        inner join v_Emp d on a.Sales_Auto=d.User_Auto
        left join TradeItem f on c.Supplier = f.TradeItem_Auto
        where
        c.Clasen_Auto=(select Clasen_Auto from orders where Orders_Auto=#{param} )
        and
        datediff(m,a.StartDT,getdate())&lt;=6
        order By ListPrice desc,a.StartDT desc
    </select>
    <resultMap id="queryMessageList" extends="BaseResultMap" type="com.funtl.myshop.plus.provider.domain.MessageList">
        <result column="MakNo" jdbcType="VARCHAR" property="makNo"/>
        <result column="ClasenName" jdbcType="VARCHAR" property="clasenName"/>
        <result column="CusName" jdbcType="VARCHAR" property="cusName"/>
        <result column="SalesName" jdbcType="VARCHAR" property="salesName"/>
        <result column="IncName" jdbcType="VARCHAR" property="incName"/>
        <result column="OrdersFeeAmt" jdbcType="DECIMAL" property="ordersFeeAmt"/>
        <result column="RequestAmt" jdbcType="DECIMAL" property="requestAmt"/>
        <result column="Status" jdbcType="INTEGER" property="status"/>
        <result column="StatusD" jdbcType="VARCHAR" property="statusD"/>
        <result column="RequestDT" jdbcType="TIMESTAMP" property="requestDT"/>
        <result column="OrdersFeeRequest_Auto" jdbcType="BIGINT" property="ordersFeeRequestAuto"/>
<!--        <result column="Remark" jdbcType="VARCHAR" property="remark"/>-->
        <result column="YJCDT" jdbcType="TIMESTAMP" property="yjCDT"/>
<!--        <result column="MakDT" jdbcType="TIMESTAMP" property="makDT"/>-->
<!--        <result column="CarNo" jdbcType="VARCHAR" property="carNO"/>-->
        <result column="Type" jdbcType="INTEGER" property="type"/>
        <result column="TypeD" jdbcType="VARCHAR" property="typeD"/>
        <result column="ZJAmt" jdbcType="DECIMAL" property="zJAmt"/>
        <result column="XZAmt" jdbcType="DECIMAL" property="xZAmt"/>
    </resultMap>
    <select id="selectMessageList" resultMap="queryMessageList">
        declare
        @type int,
        @YY int,
        @MM int,
        @SearchWord nvarchar(1000)
        set @type=#{param.type}
        set @YY=#{param.year}
        set @MM=#{param.month}
        set @SearchWord=#{param.searchWord}
        declare @Order_T table(Order_Auto bigint)
        declare @dateFrom nvarchar(20),@dateTo nvarchar(20)
        if(@YY!=0 and @MM!=0)
        begin
        select @dateFrom=convert(nvarchar(20),convert(datetime,convert(char(4),@YY)+'/'+convert(char(2),@MM)+'/01'),111)
        select @dateTo=convert(nvarchar(20),dateadd(dd,-1,dateadd(MM,1,convert(datetime,convert(char(4),@YY)+'/'+convert(char(2),@MM)+'/01'))),111)
        end

        if(@Type=0)--申购单号-0,2020,10，28016 请款数据中的选取
        begin
        if(@SearchWord='')
        select @SearchWord='0'
        insert into @Order_T(Order_Auto)
        select Order_Auto
        from [Order]
        where (Order_Auto=cast(@SearchWord as bigint) or @SearchWord='0')
        and YJCDT is not null
        and (
        ( YJCDT between @dateFrom and  @dateTo and @YY!=0)
        or(@YY=0))
        end
        if(@Type=1)--车号 1,2020,10，苏E82Y8E 请款数据中的选取
        begin
        if(@SearchWord!='')
        select @SearchWord='%'+@SearchWord+'%'
        insert into @Order_T(Order_Auto)
        select Order_Auto
        from [order] t1,CarBase t2
        where  t1.YJCDT is not null
        and t1.YJCDT between @dateFrom and  @dateTo
        and t1.CarBase_Auto=t2.CarBase_Auto
        and (t2.MakNo like @SearchWord or @SearchWord='')
        end
        if(@Type=2)--客户名称 2,2020,10，东莞明冠织带制品有限公司 请款数据中的选取
        begin
        if(@SearchWord!='')
        select @SearchWord='%'+@SearchWord+'%'
        insert into @Order_T(Order_Auto)
        select Order_Auto
        from [order] t1,TradeItem t2
        where  t1.YJCDT is not null
        and t1.YJCDT between @dateFrom and  @dateTo
        and t1.TradeItem_Auto=t2.TradeItem_Auto
        and (t2.FName like @SearchWord or @SearchWord='')
        end
        if(@Type=6)--车架号 6,2020,10，LB1WG3E18K8080319请款数据中的选取
        begin
        if(@SearchWord!='')
        select @SearchWord='%'+@SearchWord+'%'
        insert into @Order_T(Order_Auto)
        select Order_Auto
        from [order] t1,CarBase t2
        where  t1.YJCDT is not null
        and t1.YJCDT between @dateFrom and  @dateTo
        and t1.CarBase_Auto=t2.CarBase_Auto
        and (t2.CarNo like @SearchWord or @SearchWord='')
        end
        if(@Type=0 or @Type=1 or @Type=2 or @Type=6)
        begin
        select t1.Order_Auto,t3.MakNo,ClasenName=isnull(t4.ClasenName,''),CusName=t5.FName
        ,SalesName=isnull(t6.FName,''),IncName=ISNULL(t7.SName,'')
        --,OrdersFeeAmt=isnull((select isnull(sum(isnull(a.FeeAmt,0)),0) from OrdersFee a where a.Orders_Auto=t1.Orders_Auto and a.FeeType_Auto not in(2,16,32) group by a.Orders_Auto),0)
        ,OrdersFeeAmt=isnull((select isnull(sum(isnull(a.FeeAmt,0)),0) from OrdersFee a where a.Orders_Auto=t1.Orders_Auto and a.FeeType_Auto=1 group by a.Orders_Auto),0)
        ,RequestAmt=isnull(t8.RequestAmt,0),Status=isnull(t8.Status,-1)
        ,StatusD=case isnull(t8.Status,-1) when -1 then '未请款' when 0 then '暂存' when 10 then '送件' when '20' then '核准' when 5 then '驳回' end
        ,RequestDT=isnull(convert(nvarchar(20),t8.RequestDT,111),null)
        ,OrdersFeeRequest_Auto=isnull(t8.OrdersFeeRequest_Auto,0)
        --,Remark=isnull(t8.Remark,'')
        ,YJCDT=convert(nvarchar(20),t1.YJCDT,111)
        --,Is_GPS=isnull(t8.Is_GPS,0),Is_GPS_D=case isnull(t8.Is_GPS,0) when 0 then '未维护' when 1 then '否' when 2 then '是' end
        --,MakDT=case t3.MakDT when null then '' else convert(nvarchar(20),t3.MakDT,111) end,t3.CarNo
        ,Type=isnull(t8.Type,-1),TypeD=case isnull(t8.Type,-1) when -1 then '' when 0 then '请款' when 1 then '销账' end
        ,ZJAmt=case when isnull(t8.OrdersFeeRequest_Auto,0)=0 then isnull((select sum(a.ZJAmt) from ZanJie a,Credit_Order b  where a.CreditMain_Auto=b.CreditMain_Auto and a.ZJ_Type=18 and a.FeeType_Auto=1 and a.Status not in(5,-1) and b.Orders_Auto=t1.orders_auto  group by a.CreditMain_Auto),0) else isnull(t8.ZJAmt,0) end
        ,XZAmt=isnull(t8.XZAmt,0)
        from [Order] t1
        inner join @Order_T t2 on t1.Order_Auto=t2.Order_Auto
        inner join CarBase t3 on t1.CarBase_Auto=t3.CarBase_Auto
        left outer join Clasen t4 on t4.Clasen_Auto=t3.Clasen_Auto
        inner join TradeItem t5 on t1.TradeItem_Auto=t5.TradeItem_Auto
        left outer join v_Emp t6 on t6.User_Auto=t1.Sales_Auto
        left outer join Inc t7 on t3.Inc_Auto=t7.Inc_Auto
        left outer join OrdersFeeRequest t8 on t8.Order_Auto=t1.Order_Auto and t8.Type &lt;=1
        left join Credit_Order t9 on t9.Orders_Auto=t1.Orders_Auto
        order by t1.Order_Auto,StatusD,OrdersFeeRequest_Auto
        end

        if(@Type=5)--上牌完成状态待请款数据2017/4/26 july--5,2020,10，''
        begin
        select t1.Order_Auto,t3.MakNo,ClasenName=isnull(t4.ClasenName,''),CusName=t5.FName
        ,SalesName=isnull(t6.FName,''),IncName=ISNULL(t7.SName,'')
        ,OrdersFeeAmt=isnull((select isnull(sum(isnull(a.FeeAmt,0)),0) from OrdersFee a where a.Orders_Auto=t1.Orders_Auto and a.FeeType_Auto not in(2,16,32) group by a.Orders_Auto),0)
        ,RequestAmt=0,Status=-1,StatusD='未请款',RequestDT=null
        ,OrdersFeeRequest_Auto=0,Remark='',YJCDT=convert(nvarchar(20),t1.YJCDT,111),Is_GPS=0,Is_GPS_D=' '
        ,MakDT=case t9.MakDT when null then '' else convert(nvarchar(20),t9.MakDT,111) end,t9.CreditMain_Auto,t3.CarNo
        ,Type=-1,TypeD=''
        into #a
        from LicensingApply t9
        inner join Credit_Order t10 on t9.CreditMain_Auto=t10.CreditMain_Auto
        inner join [Order] t1 on t1.Orders_Auto=t10.Orders_Auto
        and t1.Order_Auto not in(select Order_Auto from OrdersFeeRequest) and t1.YJCDT is not null
        and t1.YJCDT  between @dateFrom and  @dateTo
        inner join CarBase t3 on t1.CarBase_Auto=t3.CarBase_Auto and (t3.MakNo is not null and t3.MakNo not like '%@@%')
        left outer join Clasen t4 on t4.Clasen_Auto=t3.Clasen_Auto
        inner join TradeItem t5 on t1.TradeItem_Auto=t5.TradeItem_Auto
        left outer join v_Emp t6 on t6.User_Auto=t1.Sales_Auto
        left outer join Inc t7 on t3.Inc_Auto=t7.Inc_Auto
        --where t9.Status=4
        order by StatusD,OrdersFeeRequest_Auto

        select *
        from #a
        where OrdersFeeAmt>0
        order by StatusD,OrdersFeeRequest_Auto
        end
    </select>
</mapper>
